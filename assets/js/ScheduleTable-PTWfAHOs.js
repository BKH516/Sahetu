import{r as e,j as a,S as r,s as t,t as s,v as d,w as n,k as l,B as i,x as o,b as c,L as u}from"./index-5qCGW62d.js";import{D as y,P as g,T as x}from"./index-_hxzW_6v.js";import{u as m}from"./clock-rjJz02rw.js";import{b as p}from"./axios-CWDy4WFI.js";import"./api.config-DR9rmzRw.js";import"./trending-up-CcPWB8SY.js";const h=({isOpen:o,onClose:c,onEdit:u,initialData:g})=>{const{t:x}=m(),[p,h]=e.useState({day:"",start:"",end:""});return e.useEffect(()=>{g&&h({day:g.day,start:g.start,end:g.end})},[g]),a.jsx(y,{open:o,onOpenChange:c,title:x("schedule.editAppointment")||x("common.edit"),description:x("schedule.editAppointmentDesc")||"قم بتحديث تفاصيل الموعد",children:a.jsxs("form",{onSubmit:e=>{e.preventDefault();const a={id:g.id,...p};u(a),c()},className:"space-y-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),x("schedule.day")||"اليوم"]}),a.jsxs(r,{value:p.day,onValueChange:e=>h(a=>({...a,day:e})),children:[a.jsx(t,{className:"w-full bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 rounded-xl px-4 py-3 focus:border-blue-500 dark:focus:border-blue-400 focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-800 transition-all",children:a.jsx(s,{placeholder:x("schedule.selectDay")||"اختر اليوم"})}),a.jsx(d,{className:"dark:bg-gray-800 dark:border-gray-700 bg-white border-2 border-gray-200 rounded-xl",children:["saturday","sunday","monday","tuesday","wednesday","thursday","friday"].map(e=>a.jsx(n,{value:e,className:"text-gray-900 dark:text-white hover:bg-blue-50 dark:hover:bg-blue-900/20 focus:bg-blue-50 dark:focus:bg-blue-900/20",children:x(`schedule.days.${e}`)},e))})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),x("schedule.startTime")]}),a.jsx(l,{type:"time",value:p.start,onChange:e=>h(a=>({...a,start:e.target.value})),required:!0,className:"w-full bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 rounded-xl px-4 py-3 focus:border-green-500 dark:focus:border-green-400 focus:ring-2 focus:ring-green-200 dark:focus:ring-green-800 transition-all"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),x("schedule.endTime")]}),a.jsx(l,{type:"time",value:p.end,onChange:e=>h(a=>({...a,end:e.target.value})),required:!0,className:"w-full bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 rounded-xl px-4 py-3 focus:border-purple-500 dark:focus:border-purple-400 focus:ring-2 focus:ring-purple-200 dark:focus:ring-purple-800 transition-all"})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsx(i,{type:"button",variant:"outline",onClick:c,className:"px-6 py-3 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl font-medium transition-all",children:x("common.cancel")}),a.jsx(i,{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700 text-white font-medium rounded-xl shadow-lg transition-all",children:x("schedule.updateAppointment")||x("common.save")})]})]})})},b=["saturday","sunday","monday","tuesday","wednesday","thursday","friday"];function f({value:r,onChange:t}){const{t:s}=m(),[d,n]=e.useState(!1),l=e.useRef(null);return e.useEffect(()=>{function e(e){l.current&&!l.current.contains(e.target)&&n(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),a.jsxs("div",{className:"relative w-full",ref:l,children:[a.jsxs("button",{type:"button",className:"w-full px-4 py-3 border-2 border-cyan-400 dark:border-cyan-600 rounded-xl bg-white dark:bg-gray-800 text-right text-gray-800 dark:text-gray-100 font-medium focus:outline-none focus:ring-2 focus:ring-cyan-300 dark:focus:ring-cyan-700 transition",onClick:()=>n(e=>!e),children:[r?s(`schedule.days.${r}`):s("schedule.selectDay")||"اختر اليوم",a.jsx("span",{className:"float-left",children:d?"▲":"▼"})]}),d&&a.jsx("div",{className:"absolute z-50 w-full bg-white dark:bg-gray-800 border-2 border-cyan-400 dark:border-cyan-600 rounded-xl shadow-lg mt-2 max-h-[25vh] overflow-y-auto",children:b.map(e=>a.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/30 text-gray-900 dark:text-gray-100 "+(r===e?"bg-cyan-100 dark:bg-cyan-900/50 font-bold":""),onClick:()=>{t(e),n(!1)},children:s(`schedule.days.${e}`)},e))})]})}const k=({isOpen:r,onClose:t,onAdd:s})=>{const{t:d}=m(),[n,c]=e.useState({day:"",start:"",end:""});return a.jsx(y,{open:r,onOpenChange:t,title:d("schedule.addNewAppointment")||d("schedule.addAppointment"),description:d("schedule.addAppointmentDesc")||"أدخل تفاصيل الموعد الجديد",children:a.jsxs("form",{onSubmit:e=>{e.preventDefault();const a={day:o(n.day),start:o(n.start),end:o(n.end)},r={id:Date.now(),...a};s(r),c({day:"",start:"",end:""})},className:"space-y-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),d("schedule.day")||"اليوم"]}),a.jsx(f,{value:n.day,onChange:e=>c(a=>({...a,day:e}))})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),d("schedule.startTime")]}),a.jsx(l,{type:"time",value:n.start,onChange:e=>c(a=>({...a,start:e.target.value})),required:!0,className:"w-full bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 rounded-xl px-4 py-3 focus:border-green-500 dark:focus:border-green-400 focus:ring-2 focus:ring-green-200 dark:focus:ring-green-800 transition-all"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),d("schedule.endTime")]}),a.jsx(l,{type:"time",value:n.end,onChange:e=>c(a=>({...a,end:e.target.value})),required:!0,className:"w-full bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 rounded-xl px-4 py-3 focus:border-purple-500 dark:focus:border-purple-400 focus:ring-2 focus:ring-purple-200 dark:focus:ring-purple-800 transition-all"})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsx(i,{type:"button",variant:"outline",onClick:t,className:"px-6 py-3 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl font-medium transition-all",children:d("common.cancel")}),a.jsx(i,{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-medium rounded-xl shadow-lg transition-all",children:d("schedule.addAppointment")})]})]})})},w=()=>{const{t:r,i18n:t}=m();t.language;const s={saturday:r("schedule.days.saturday"),sunday:r("schedule.days.sunday"),monday:r("schedule.days.monday"),tuesday:r("schedule.days.tuesday"),wednesday:r("schedule.days.wednesday"),thursday:r("schedule.days.thursday"),friday:r("schedule.days.friday")},d=Object.fromEntries(Object.entries(s).map(([e,a])=>[a,e])),[n,l]=e.useState([]),[o,y]=e.useState(!0),[b,f]=e.useState(null),[w,v]=e.useState(null),[N,_]=e.useState(null),S=(e,a)=>{_({message:e,type:a}),setTimeout(()=>_(null),3e3)},C=["saturday","sunday","monday","tuesday","wednesday","thursday","friday"],A=[...n].sort((e,a)=>C.indexOf(e.day_of_week)-C.indexOf(a.day_of_week)),[E,z]=e.useState(!1),[D,O]=e.useState(null),T=Object.keys(s).find(e=>s[e]===s[(new Date).toLocaleDateString("ar-EG",{weekday:"long"})])||"",{isAuthenticated:$}=c();e.useEffect(()=>{$&&q()},[$]);const q=async()=>{y(!0),f(null);try{const e=(await p.get("/api/doctor/schedules")).data,a=Array.isArray(e)?e:Array.isArray(e.data)?e.data:[];l(a)}catch(e){f(r("schedule.loadingError"))}finally{y(!1)}},L=e=>()=>{R(e)},R=async e=>{if(v(null),f(null),e)try{await p.delete(`/api/doctor/schedules/${e}`),l(a=>a.filter(a=>a.id!==e)),S(r("schedule.deleteSuccess"),"success")}catch(a){S(r("schedule.deleteError"),"error")}else S(r("schedule.deleteError"),"error")};return o?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx(u,{size:"lg"})}):a.jsxs("div",{className:"space-y-6 min-h-0 relative",children:[a.jsx("div",{className:"flex justify-end gap-2",children:a.jsxs(i,{onClick:()=>z(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg shadow-md text-sm sm:text-base font-medium",children:["+ ",r("schedule.addNewAppointment")||r("schedule.addAppointment")]})}),b&&a.jsx("div",{className:"text-center text-red-500 py-2",children:b}),w&&a.jsx("div",{className:"text-center text-green-600 font-bold py-2",children:w}),a.jsx(k,{isOpen:E,onClose:()=>z(!1),onAdd:async e=>{await(async e=>{v(null),f(null);try{const a=new URLSearchParams;a.append("day_of_week",d[e.day]),a.append("start_time",e.start?.slice(0,5)),a.append("end_time",e.end?.slice(0,5));const t=await p.post("/api/doctor/schedules",a,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),s=t.data&&"object"==typeof t.data&&!Array.isArray(t.data)&&t.data.data?t.data.data:t.data;l(e=>[...e,s]),S(r("schedule.addSuccess"),"success")}catch(a){const e=a?.response?.data?.message;let t=r("schedule.addError");e&&e.includes("validation")?t=r("services.invalidData"):e&&e.includes("required")?t=r("services.allFieldsRequired"):e&&e.includes("conflict")&&(t=r("schedule.addError")),S(t,"error")}})(e),z(!1)},existingSchedule:n.map(e=>({id:e.id,day:s[e.day_of_week],start:e.start_time,end:e.end_time}))}),null!==D&&a.jsx(h,{isOpen:null!==D,onClose:()=>O(null),onEdit:async e=>{await(async e=>{if(v(null),f(null),e&&e.id)try{const a=new URLSearchParams;a.append("day_of_week",d[e.day]),a.append("start_time",e.start?.slice(0,5)),a.append("end_time",e.end?.slice(0,5));const t=await p.post(`/api/doctor/schedules/${e.id}`,a,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),s=t.data&&"object"==typeof t.data&&!Array.isArray(t.data)&&t.data.data?t.data.data:t.data;l(a=>a.map(a=>a.id===e.id?s:a)),S(r("schedule.updateSuccess"),"success")}catch(a){S(r("schedule.updateError"),"error")}else S(r("schedule.updateError"),"error")})(e),O(null)},initialData:(()=>{const e=n[D];return{id:e.id,day:s[e.day_of_week],start:e.start_time,end:e.end_time}})()}),a.jsx("div",{className:"relative rounded-3xl shadow-lg bg-white mt-4 fade-in dark:bg-card-dark dark:shadow-[0_2px_16px_0_rgba(36,44,80,0.18)] rounded-tl-[2.5rem] rounded-br-[2.5rem] overflow-hidden",children:a.jsx("div",{className:"w-full overflow-x-auto",children:a.jsxs("table",{className:"min-w-full w-full divide-y divide-gray-200 dark:divide-zinc-700 text-center align-middle",children:[a.jsx("thead",{className:"bg-slate-50 dark:bg-zinc-800 sticky top-0 z-10",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-xs font-bold text-white uppercase tracking-wide whitespace-nowrap bg-green-600 dark:bg-green-800",children:r("schedule.day")||"اليوم"}),a.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wide whitespace-nowrap",children:r("schedule.startTime")}),a.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wide whitespace-nowrap",children:r("schedule.endTime")}),a.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wide whitespace-nowrap",children:r("services.actions")})]})}),a.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-zinc-800",children:A.map((e,t)=>{const d=e.day_of_week===T;return a.jsxs("tr",{className:`transition-colors ${d?"bg-yellow-50 dark:bg-yellow-900/30":t%2==0?"bg-white dark:bg-zinc-900":"bg-gray-50 dark:bg-zinc-800"} hover:bg-accent/10 dark:hover:bg-zinc-700`,children:[a.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 whitespace-nowrap font-medium text-gray-900 dark:text-gray-100 text-center align-middle text-sm sm:text-base",children:s[e.day_of_week]}),a.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 whitespace-nowrap text-gray-900 dark:text-gray-100 text-center align-middle text-sm sm:text-base",children:j(e.start_time)}),a.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 whitespace-nowrap text-gray-900 dark:text-gray-100 text-center align-middle text-sm sm:text-base",children:j(e.end_time)}),a.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 whitespace-nowrap text-center align-middle",children:a.jsxs("div",{className:"flex justify-center gap-2 sm:gap-3",children:[a.jsx("button",{type:"button",onClick:(l=e.id,()=>{const e=n.findIndex(e=>e.id===l);-1!==e&&O(e)}),className:"w-7 h-7 sm:w-9 sm:h-9 flex items-center justify-center rounded-full bg-blue-100 hover:bg-blue-200 text-blue-600 shadow transition-all dark:bg-blue-700 dark:hover:bg-blue-800 dark:text-white",title:r("common.edit"),children:a.jsx(g,{size:14,className:"sm:w-4 sm:h-4"})}),a.jsx("button",{type:"button",onClick:L(e.id),className:"w-7 h-7 sm:w-9 sm:h-9 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-600 shadow transition-all dark:bg-red-700 dark:hover:bg-red-800 dark:text-white",title:r("common.delete"),children:a.jsx(x,{size:14,className:"sm:w-4 sm:h-4"})})]})})]},e.id);var l})})]})})}),N&&a.jsxs("div",{style:{position:"fixed",bottom:18,left:18,zIndex:99999,minWidth:120,maxWidth:220,padding:"7px 16px 7px 10px",borderRadius:"8px",background:"success"===N.type?"#22c55e":"#ef4444",color:"#fff",fontWeight:500,fontSize:"0.85rem",boxShadow:"0 2px 8px rgba(0,0,0,0.13)",display:"flex",alignItems:"center",gap:7,pointerEvents:"none",userSelect:"none"},children:[a.jsx("span",{style:{fontSize:"1.1em",marginRight:6,display:"flex",alignItems:"center"},children:"success"===N.type?"✔️":"⚠️"}),a.jsx("span",{style:{flex:1},children:N.message})]})]})};function j(e){if(!e)return"-";const[a,r]=e.split(":");return`${a}:${r}`}export{w as default};
