import{a as e,r,k as t,j as s,L as a,q as l,B as n,C as d,A as i,D as c}from"./index-99IqcOUf.js";import{a as o,b as x,c as m,d as g}from"./index-CYIOlG9_.js";import{S as u,F as h,D as b,a as p}from"./DropdownFilterButton-Dpig8siC.js";import{T as f}from"./trending-up-Hy3b_itb.js";import"./clock-sLeXm9or.js";import"./user-kOcpVDJ_.js";const j=()=>{const{t:j,i18n:k}=e(),[N,w]=r.useState([]),[_,z]=r.useState(!0),[S,C]=r.useState("all"),[A,L]=r.useState("all"),[$,D]=r.useState(""),[E,B]=r.useState(1),[I,F]=r.useState(null),[T,U]=r.useState(!1),[M,P]=r.useState(!1);r.useEffect(()=>{P(!0),G()},[]),r.useEffect(()=>{const e=()=>{G()};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[]);const G=async()=>{z(!0);try{const e=(await t.get("/api/doctor/reservations")).data,r=Array.isArray(e)?e:Array.isArray(e.data)?e.data:[];w(r)}catch(e){w([])}finally{z(!1)}},H=M?N.filter(e=>{const r=["completed","cancelled"].includes(e.status)&&("all"===S||e.status===S),t="all"===A||e.date&&e.date.includes(A),s=v(e,u.get(e.id)),a=(s.full_name||"").toLowerCase().includes($.toLowerCase())||(e.doctor_service?.name||"").toLowerCase().includes($.toLowerCase())||(s.phone_number||"").includes($);return r&&t&&a}):[],O=Math.ceil(H.length/5),q=5*(E-1),R=q+5,J=H.slice(q,R),K=e=>{switch(e){case"completed":return j("reservations.status.completed");case"cancelled":return j("reservations.status.cancelled");case"rejected":return j("reservations.status.rejected");default:return e}},Q=e=>{switch(e){case"completed":return"bg-success/10 text-success dark:bg-success/20 dark:text-success-light";case"cancelled":return"bg-danger/10 text-danger dark:bg-danger/20 dark:text-danger-light";case"rejected":return"bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"}},V=N.filter(e=>"completed"===e.status).length,W=N.filter(e=>"cancelled"===e.status).length,X=N.filter(e=>"completed"===e.status&&e.doctor_service?.price).reduce((e,r)=>e+Number(r.doctor_service?.price||0),0);return _||!M?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx(a,{size:"lg"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs(h,{children:[s.jsxs("div",{className:"flex-1 min-w-[180px]",children:[s.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:j("common.search")}),s.jsx(l,{id:"search",placeholder:j("history.searchPlaceholder"),value:$,onChange:e=>D(e.target.value),className:"dark:bg-zinc-800 dark:border-zinc-700 dark:text-gray-100 dark:placeholder:text-gray-400"})]}),s.jsx(b,{options:[{value:"all",label:j("history.allStatuses")},{value:"completed",label:j("history.completedStatus")},{value:"cancelled",label:j("reservations.status.cancelled")}],value:S,onChange:C,placeholder:j("reservations.selectStatus"),className:"min-w-[140px]",section:"history",size:"sm"}),s.jsx("div",{className:"flex-1 min-w-[140px]",children:s.jsx(l,{placeholder:j("history.searchByDate"),value:"all"===A?"":A,onChange:e=>L(e.target.value||"all"),className:"dark:bg-zinc-800 dark:border-zinc-700 dark:text-gray-100 dark:placeholder:text-gray-400"})}),s.jsx("div",{className:"flex items-end",children:s.jsx(n,{onClick:()=>{D(""),C("all"),L("all")},section:"history",size:"sm",variant:"outline",className:"w-full",children:j("common.reset")})})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mb-6",children:[s.jsx(p,{icon:s.jsx(d,{className:"text-green-600 dark:text-green-400"}),label:j("history.completedStatus"),value:V,color:"bg-green-100 text-green-600 dark:bg-green-900 dark:text-green-400"}),s.jsx(p,{icon:s.jsx(i,{className:"text-red-600 dark:text-red-400"}),label:j("reservations.status.cancelled"),value:W,color:"bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-400"}),s.jsx(p,{icon:s.jsx(f,{className:"text-primary dark:text-primary-light"}),label:j("reservations.totalRevenue"),value:`${X} ${j("reservations.currencyShort")}`,color:"bg-primary/10 text-primary dark:bg-primary/20 dark:text-primary-light"})]}),J.length>0?s.jsx("div",{className:"relative overflow-hidden rounded-2xl bg-white dark:bg-zinc-900 shadow-xl dark:shadow-2xl border border-gray-100 dark:border-zinc-800 fade-in pb-6",style:{marginBottom:"50px"},children:s.jsx("div",{className:"overflow-x-auto overflow-y-auto max-h-[80vh] custom-scrollbar",children:s.jsxs("table",{className:"min-w-full divide-y-0",children:[s.jsx("thead",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-zinc-800 dark:to-zinc-800/90 sticky top-0 z-10 border-b-2 border-blue-200 dark:border-zinc-700",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wider",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),s.jsx("span",{children:j("history.columns.patient")})]})}),s.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wider",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500"}),s.jsx("span",{children:j("history.columns.service")})]})}),s.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wider",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),s.jsx("span",{children:j("history.columns.dateAndTime")})]})}),s.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wider",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),s.jsx("span",{children:j("history.columns.durationAndPrice")})]})}),s.jsx("th",{className:"px-6 py-4 text-center text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wider",children:s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),s.jsx("span",{children:j("history.columns.status")})]})})]})}),s.jsx("tbody",{className:"divide-y-2 divide-gray-100 dark:divide-zinc-800",children:J.map((e,r)=>{const t=u.get(e.id),a=v(e,t);return s.jsxs("tr",{className:"group transition-all duration-200 hover:bg-blue-50 dark:hover:bg-zinc-800 "+(r%2==0?"bg-white dark:bg-zinc-900":"bg-gray-100 dark:bg-zinc-800/80"),children:[s.jsx("td",{className:"px-6 py-5",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold shadow-lg text-sm",children:(a.full_name||j("reservations.defaultInitial"))[0].toUpperCase()}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx("p",{className:"text-sm font-bold text-gray-900 dark:text-gray-100 truncate",children:a.full_name||"-"})}),s.jsx("button",{onClick:()=>(F(e),void U(!0)),className:"flex-shrink-0 p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30 hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-all duration-200 group",title:j("reservations.viewPatientInfo"),children:s.jsx(c,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform"})})]})}),s.jsx("td",{className:"px-6 py-5",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-lg bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-sm",children:s.jsx("span",{className:"text-orange-600 dark:text-orange-400",children:"ðŸ¥"})}),s.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e.doctor_service?.name||"-"})]})}),s.jsx("td",{className:"px-6 py-5",children:s.jsxs("div",{className:"space-y-1.5",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-gray-900 dark:text-gray-100",children:[s.jsx("span",{className:"text-green-600 dark:text-green-400",children:"ðŸ“…"}),s.jsx("span",{children:e.date?new Date(e.date).toLocaleDateString("ar"===k.language?"ar-EG":"en-US",{month:"short",day:"numeric"}):"-"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400",children:[s.jsx("span",{children:"â°"}),s.jsx("span",{className:"font-mono",children:e.start_time?y(e.start_time):"-"}),s.jsx("span",{children:"â†’"}),s.jsx("span",{className:"font-mono",children:e.end_time?y(e.end_time):"-"})]})]})}),s.jsx("td",{className:"px-6 py-5",children:s.jsxs("div",{className:"space-y-1.5",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-900 dark:text-gray-100",children:[s.jsx("span",{children:"â±ï¸"}),s.jsx("span",{className:"font-medium",children:e.doctor_service?.duration_minutes?`${e.doctor_service.duration_minutes} ${j("services.minutes")}`:"-"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400",children:[s.jsx("span",{children:"ðŸ’°"}),s.jsx("span",{className:"font-medium",children:e.doctor_service?.price?`${e.doctor_service.price} ${j("reservations.currencyShort")}`:"-"})]})]})}),s.jsx("td",{className:"px-6 py-5 text-center",children:s.jsxs("span",{className:`inline-flex items-center gap-1.5 px-4 py-2 rounded-full text-xs font-bold shadow-sm ${Q(e.status)} transition-all duration-200 hover:scale-105`,children:[s.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-current animate-pulse"}),K(e.status)]})})]},e.id)})})]})})}):s.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-zinc-900 dark:to-zinc-800 border-2 border-dashed border-blue-300 dark:border-zinc-700 p-12 text-center fade-in",style:{marginBottom:"55px"},children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-200 dark:bg-blue-900/20 rounded-full -mr-16 -mt-16 opacity-50"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-40 h-40 bg-indigo-200 dark:bg-indigo-900/20 rounded-full -ml-20 -mb-20 opacity-50"}),s.jsxs("div",{className:"relative z-10 space-y-4",children:[s.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-4xl",children:"ðŸ“Š"}),s.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:j("history.noHistory")}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md mx-auto",children:j("history.noHistoryFound")})]})]}),O>1&&s.jsxs("div",{className:"flex justify-center gap-4",children:[s.jsx(n,{variant:"outline",onClick:()=>B(e=>Math.max(e-1,1)),disabled:1===E,section:"history",size:"sm",className:"dark:border-zinc-700 dark:text-gray-100 dark:hover:bg-zinc-800",children:j("common.previous")}),s.jsx("span",{className:"flex items-center px-4 text-gray-700 dark:text-gray-300",children:j("history.pageInfo",{current:E,total:O})}),s.jsx(n,{variant:"outline",onClick:()=>B(e=>Math.min(e+1,O)),disabled:E===O,section:"history",size:"sm",className:"dark:border-zinc-700 dark:text-gray-100 dark:hover:bg-zinc-800",children:j("common.next")})]}),I&&(()=>{const e=u.get(I.id),r=v(I,e);return s.jsx(o,{open:T,onOpenChange:U,children:s.jsxs(x,{className:"sm:max-w-[500px] bg-white dark:bg-zinc-900 border-gray-200 dark:border-zinc-800",children:[s.jsx(m,{children:s.jsxs(g,{className:"text-xl font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold shadow-lg",children:(r.full_name||j("reservations.defaultInitial"))[0].toUpperCase()}),j("reservations.patientInfoTitle")]})}),s.jsxs("div",{className:"space-y-4 mt-4",children:[s.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-blue-200 dark:border-blue-800",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-lg bg-blue-500 dark:bg-blue-600 flex items-center justify-center",children:s.jsx("span",{className:"text-white text-lg",children:"ðŸ‘¤"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:j("reservations.fullName")}),s.jsx("p",{className:"text-sm font-bold text-gray-900 dark:text-gray-100",children:r.full_name||"-"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-blue-200 dark:border-blue-800",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-lg bg-green-500 dark:bg-green-600 flex items-center justify-center",children:s.jsx("span",{className:"text-white text-lg",children:"ðŸ“ž"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:j("profile.phoneNumber")}),r.phone_number?s.jsx("p",{className:"text-sm font-bold text-gray-900 dark:text-gray-100 dir-ltr text-right",children:r.phone_number}):s.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 italic text-right",children:j("history.notAvailableOld")})]})]}),s.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-blue-200 dark:border-blue-800",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-lg bg-orange-500 dark:bg-orange-600 flex items-center justify-center",children:s.jsx("span",{className:"text-white text-lg",children:"ðŸ¥"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:j("services.serviceName")}),s.jsx("p",{className:"text-sm font-bold text-gray-900 dark:text-gray-100",children:I?.doctor_service?.name||"-"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-blue-200 dark:border-blue-800",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-lg bg-purple-500 dark:bg-purple-600 flex items-center justify-center",children:s.jsx("span",{className:"text-white text-lg",children:"ðŸ“…"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:j("reservations.date")}),s.jsx("p",{className:"text-sm font-bold text-gray-900 dark:text-gray-100",children:I?.date?new Date(I.date).toLocaleDateString("ar"===k.language?"ar-EG":"en-US",{year:"numeric",month:"long",day:"numeric"}):"-"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-lg bg-indigo-500 dark:bg-indigo-600 flex items-center justify-center",children:s.jsx("span",{className:"text-white text-lg",children:"â°"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:j("history.columns.dateAndTime")}),s.jsxs("p",{className:"text-sm font-bold text-gray-900 dark:text-gray-100 dir-ltr text-right",children:[I?.start_time?y(I.start_time):"-"," - ",I?.end_time?y(I.end_time):"-"]})]})]})]}),s.jsx("div",{className:"flex justify-end pt-2",children:s.jsx(n,{onClick:()=>U(!1),variant:"outline",className:"dark:border-zinc-700 dark:text-gray-100 dark:hover:bg-zinc-800",children:j("common.close")})})]})]})})})()]})};function y(e){if(!e)return"-";const[r,t]=e.split(":");return`${r}:${t}`}function v(e,r){if(r&&r.phone_number)return{full_name:r.full_name||e.user?.full_name||e.full_name||"",phone_number:r.phone_number||"",age:r.age||e.user?.age||e.age||"",gender:r.gender||e.user?.gender||e.gender||""};if(e.full_name&&e.phone_number)return{full_name:e.full_name,phone_number:e.phone_number,age:e.age||"",gender:e.gender||""};const t=e.user?.account?.phone_number||e.user?.phone_number||e.user?.phone||e.user?.account?.phone||e.phone_number||e.phone||e.mobile||e.user?.mobile||e.user?.account?.mobile||e.user?.contact_number||e.contact_number||e.user?.telephone||e.telephone||"";return{full_name:e.user?.account?.full_name||e.user?.full_name||"",phone_number:t,age:e.user?.age||e.age||"",gender:e.user?.gender||e.gender||""}}export{j as default};
