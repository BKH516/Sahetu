import{R as e,r as t,b as a,a as r,j as o,I as i,B as s,L as n,l,i as d}from"./index-5qCGW62d.js";import{r as c,a as m}from"./axios-CWDy4WFI.js";import{b as u,F as g,m as x,A as h,S as p}from"./Particles3D-BozLC8BX.js";import{L as b}from"./LanguageSwitcher-DThpmtcw.js";import{u as f,C as w}from"./clock-rjJz02rw.js";import{Z as v}from"./zap-BwHwb4JW.js";import{A as y}from"./award-iayhA-92.js";import{C as j,L as k}from"./lock-DdOLKOZg.js";import{E as N}from"./eye-off-DnDZ2EPq.js";import{E}from"./eye-CfeDFNnZ.js";import{M as L}from"./mail-BceQofFo.js";const S=e.memo(({onSwitchToRegister:e,onLoginSuccess:S,onForgotPassword:I,onBackToLanding:_})=>{const{t:C,i18n:T}=f(),[A,O]=t.useState(""),[F,M]=t.useState(""),[D,R]=t.useState(!1),[z,P]=t.useState({}),[$,U]=t.useState(!1),[B,q]=t.useState(navigator.onLine),[H,W]=t.useState(!1),[Z,G]=t.useState(!1),[X,K]=t.useState(0),{login:J}=a();r();const Q=t.useMemo(()=>"ar"===T.language,[T.language]),V=t.useRef(z);t.useEffect(()=>{V.current=z},[z]);const Y=t.useCallback(e=>{O(e.target.value),V.current.email&&P(e=>({...e,email:void 0}))},[]),ee=t.useCallback(e=>{M(e.target.value),V.current.password&&P(e=>({...e,password:void 0}))},[]),te=t.useCallback(()=>{R(e=>!e)},[]);t.useEffect(()=>{let e=localStorage.getItem("theme");const t=()=>{const t=document.documentElement,a=localStorage.getItem("theme"),r=window.matchMedia("(prefers-color-scheme: dark)").matches;let o=!1;"dark"===a?o=!0:"light"===a?o=!1:"auto"!==a&&a||(o=r);const i=t.classList.contains("dark");o&&!i?t.classList.add("dark"):!o&&i&&t.classList.remove("dark"),e=a};t();const a=e=>{"theme"===e.key&&t()};window.addEventListener("storage",a);const r=()=>{t()};window.addEventListener("themechange",r);let o=null;const i=new MutationObserver(()=>{o&&clearTimeout(o),o=setTimeout(()=>{localStorage.getItem("theme")!==e&&t()},100)});return i.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>{window.removeEventListener("storage",a),window.removeEventListener("themechange",r),i.disconnect(),o&&clearTimeout(o)}},[]),t.useEffect(()=>{let e=null,t=window.innerWidth;const a=()=>{e&&cancelAnimationFrame(e),e=requestAnimationFrame(()=>{const e=window.innerWidth;Math.abs(e-t)>10&&(W(e>=1024),t=e)})};let r=null;const o=()=>{r&&clearTimeout(r),r=setTimeout(a,150)};return a(),window.addEventListener("resize",o,{passive:!0}),()=>{window.removeEventListener("resize",o),e&&cancelAnimationFrame(e),r&&clearTimeout(r)}},[]),t.useEffect(()=>{const e=()=>q(!0),t=()=>q(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),t.useEffect(()=>{if((()=>{const e=c.getBlockInfo(`login_${A}`);e?.blocked?(G(!0),K(e.remainingTime)):(G(!1),K(0))})(),Z&&X>0){const e=setInterval(()=>{K(e=>e<=1e3?(G(!1),0):e-1e3)},1e3);return()=>clearInterval(e)}},[A,Z,X]);const ae=t.useMemo(()=>{let e=0;return F.length>=8&&(e+=1),/[A-Z]/.test(F)&&(e+=1),/[a-z]/.test(F)&&(e+=1),/\d/.test(F)&&(e+=1),/[^A-Za-z0-9]/.test(F)&&(e+=1),e},[F]),re=t.useCallback(()=>{if("function"==typeof _)try{return void _()}catch{}if(window.history&&window.history.length>1)return void window.history.back();const e=import.meta?.env?.BASE_URL||"/";window.location.assign(e)},[_]),oe=e=>String(e).replace(/\(and \d+ more errors?\)/gi,"").replace(/\(and \d+ more\)/gi,"").replace(/and \d+ more errors?\.?/gi,"").trim(),ie=async e=>{if(e.preventDefault(),!(()=>{const e={};return A?d(A)||(e.email=C("auth.login.emailInvalid")):e.email=C("auth.login.emailRequired"),F?F.length<6&&(e.password=C("auth.login.passwordMinLength")):e.password=C("auth.login.passwordRequired"),P(e),0===Object.keys(e).length})())return;if(!navigator.onLine)return void P({general:C("auth.login.noInternet")});if(!A.trim()||!F.trim())return void P({general:C("auth.login.enterCredentials")});const t=`login_${A}`,a=c.checkLimit(t,5,3e5,6e5);if(!a.allowed){G(!0),K(a.resetTime-Date.now());const e=Math.ceil((a.resetTime-Date.now())/6e4);return void P({general:C("auth.login.rateLimitExceeded",{minutes:e})})}U(!0),P({});try{const e={email:A,password:F},t=await(async e=>{const t=["/api/doctor/login","/api/login","/api/auth/login","/login"];let a=null;for(const o of t)try{const t=await m.post(o,e);if(t.status>=200&&t.status<300)return t;a=t}catch(r){if(a=r,r.response?.status&&404!==r.response.status)throw r}if(!a)throw new Error(C("auth.login.loginFailed"));throw a})(e);if(t.data.token){const e=e=>{let t=e.split("@")[0].replace(/[._-]/g," ");return t=t.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),`ÿØŸÉÿ™Ÿàÿ± ${t}`},a={id:t.data.user?.id||1,email:A,full_name:t.data.user?.name||t.data.user?.full_name||e(A),phone_number:t.data.user?.phone_number||"",role:"doctor",status:t.data.user?.status||"active",is_approved:t.data.user?.is_approved||"approved",created_at:t.data.user?.created_at||(new Date).toISOString(),updated_at:t.data.user?.updated_at||(new Date).toISOString(),roles:[{id:1,name:"doctor",guard_name:"web",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]};try{return J(a,t.data.token),void S()}catch(r){P({general:C("auth.login.generalError")})}}const a=e=>String(e).replace(/\(and \d+ more errors?\)/gi,"").replace(/\(and \d+ more\)/gi,"").replace(/and \d+ more errors?\.?/gi,"").trim(),o=t?.data?.message||t?.data?.error||C("auth.login.invalidCredentials");P({general:a(o)}),l({eventType:"LOGIN_FAILURE",userEmail:A,details:"Doctor login failed - no user/token returned",severity:"MEDIUM"})}catch(r){const e=r?.response?.data,t={};if("ERR_NETWORK"===r.code)P({general:C("auth.login.serverError")});else{const a=e?.message||e?.error||r?.message||C("auth.login.loginError");a&&(t.general=oe(String(a)));const o=e?.errors;o&&"object"==typeof o&&(o.email?.[0]&&(t.email=oe(String(o.email[0]))),o.password?.[0]&&(t.password=oe(String(o.password[0]))));const i=r?.response?.status;401!==i||t.general||(t.general=C("auth.login.invalidCreds")),403!==i||t.general||(t.general=C("auth.login.noPermission")),t.general||(t.general=C("auth.login.generalError")),P(t)}l({eventType:"LOGIN_FAILURE",userEmail:A,details:r?.response?.data?.message||r?.message||"Unknown error",severity:"MEDIUM"})}finally{U(!1)}},se=(e,t,a,r,i,s)=>{const n="password"===r;return o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-y-0 start-0 flex items-center ps-4 pointer-events-none text-gray-400 transition-colors duration-300 group-focus-within:text-blue-600",children:i}),o.jsx("input",{type:n&&s&&D?"text":r,id:e,value:t||"",onChange:t=>{"email"===e&&Y(t),"password"===e&&ee(t)},className:`w-full ps-12 ${s&&n?"pe-12":"pe-4"} py-4 bg-white/80 dark:bg-gray-900/50 border-2 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-blue-500/30 focus:border-blue-500 ${z[e]?"border-red-500 focus:ring-red-500/30 focus:border-red-500":"border-gray-300 dark:border-gray-700 hover:border-blue-600 dark:hover:border-blue-600"}`,placeholder:a,required:!0,disabled:$||!B||Z}),s&&n&&o.jsx("button",{type:"button",onClick:te,className:"absolute inset-y-0 end-0 flex items-center pe-4 text-gray-400 hover:text-gray-300 transition-colors",disabled:$||!B||Z,children:D?o.jsx(N,{className:"h-5 w-5"}):o.jsx(E,{className:"h-5 w-5"})})]}),z[e]&&o.jsx("p",{className:"text-sm text-red-500 dark:text-red-400 animate-in fade-in duration-200",children:z[e]})]})};return o.jsxs("div",{className:"relative min-h-screen lg:h-screen overflow-y-auto lg:overflow-hidden bg-gradient-to-br from-gray-100 dark:from-gray-900 via-gray-50 dark:via-gray-800 to-gray-100 dark:to-gray-900 flex items-center justify-center px-4 py-4 lg:py-0 transition-colors duration-300",dir:Q?"rtl":"ltr",children:[o.jsx(u,{}),o.jsx(g,{}),o.jsx("div",{className:"w-full max-w-7xl xl:max-w-8xl 2xl:max-w-9xl mx-auto px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16 relative z-10 min-h-full lg:h-full flex items-center py-4 lg:py-0",children:o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-6 xl:gap-12 w-full min-h-full lg:h-full lg:items-center",children:[o.jsx("div",{className:"hidden lg:block lg:col-span-5 overflow-hidden",children:o.jsx(x.div,{initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.8,ease:"easeOut"},className:"h-full flex items-center",children:o.jsxs("div",{className:"bg-gradient-to-br from-blue-400/90 dark:from-blue-600/95 via-indigo-400/90 dark:via-indigo-600/95 to-purple-400/90 dark:to-purple-600/95 rounded-3xl shadow-2xl relative overflow-hidden w-full h-[600px] p-10 flex flex-col justify-center transition-colors duration-300",children:[o.jsx("div",{className:"absolute top-4 end-4 z-20",children:o.jsx(b,{})}),o.jsxs("div",{className:"absolute inset-0 opacity-20 pointer-events-none select-none",children:[o.jsx(x.div,{className:"absolute top-0 left-0 w-80 h-80 bg-blue-300 dark:bg-blue-400 rounded-full blur-3xl transition-colors duration-300",animate:{scale:[1,1.2,1],x:[0,50,0],y:[0,30,0]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),o.jsx(x.div,{className:"absolute bottom-0 right-0 w-80 h-80 bg-purple-300 dark:bg-purple-400 rounded-full blur-3xl transition-colors duration-300",animate:{scale:[1,1.3,1],x:[0,-40,0],y:[0,-50,0]},transition:{duration:10,repeat:1/0,ease:"easeInOut"}}),o.jsx(x.div,{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-60 h-60 bg-indigo-300 dark:bg-indigo-400 rounded-full blur-3xl transition-colors duration-300",animate:{scale:[1,1.4,1],rotate:[0,360]},transition:{duration:15,repeat:1/0,ease:"linear"}})]}),o.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(6)].map((e,t)=>o.jsx(x.div,{className:"absolute w-2 h-2 bg-white/30 rounded-full",style:{left:20+15*t+"%",top:30+t%3*20+"%"},animate:{y:[0,-20,0],opacity:[.3,.6,.3],scale:[1,1.5,1]},transition:{duration:3+.5*t,repeat:1/0,delay:.3*t,ease:"easeInOut"}},t))}),o.jsx("div",{className:"relative z-10 flex flex-col justify-center h-full",children:o.jsxs(x.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"space-y-5",children:[o.jsxs(x.button,{type:"button",onClick:re,"aria-label":C("common.back"),title:C("common.back"),initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.4},whileHover:{scale:1.05,x:Q?-5:5},whileTap:{scale:.95},className:"relative inline-flex items-center gap-2 px-4 py-2.5 rounded-xl text-white/90 hover:text-white bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 transition-all duration-300 shadow-lg hover:shadow-xl w-fit group mb-4",children:[o.jsx(x.div,{animate:{x:Q?[0,-3,0]:[0,3,0]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:o.jsx(h,{className:"w-5 h-5 "+(Q?"":"rotate-180")})}),o.jsx("span",{className:"text-sm font-semibold",children:C("common.back")}),o.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-blue-400/20 to-purple-400/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),o.jsx(x.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.5},className:"text-5xl font-bold text-white leading-tight",children:o.jsx(i,{text:C("auth.login.welcomeBack"),className:"bg-clip-text text-transparent bg-gradient-to-r from-blue-200 via-indigo-200 to-purple-200 drop-shadow-lg"})}),o.jsx(x.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.7},className:"text-blue-50 text-lg leading-relaxed font-medium",children:C("auth.login.description")})]}),o.jsx(x.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8,delay:.9},className:"grid grid-cols-2 gap-4 mt-4",children:[{icon:p,text:C("auth.login.features.dataProtection"),color:"from-blue-400 to-cyan-400"},{icon:v,text:C("auth.login.features.fastSupport"),color:"from-purple-400 to-pink-400"},{icon:w,text:C("auth.login.features.arabicInterface"),color:"from-indigo-400 to-blue-400"},{icon:y,text:C("auth.login.features.secureLogin"),color:"from-cyan-400 to-blue-400"}].map((e,t)=>o.jsxs(x.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:1+.1*t},whileHover:{scale:1.05,y:-5},className:"group relative overflow-hidden bg-white/10 backdrop-blur-md rounded-2xl p-4 border border-white/20 hover:border-white/40 transition-all duration-300",children:[o.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${e.color} opacity-0 group-hover:opacity-20 transition-opacity duration-300`}),o.jsxs("div",{className:"relative flex items-start gap-3",children:[o.jsx(x.div,{whileHover:{rotate:360},transition:{duration:.5},className:`p-2 rounded-xl bg-gradient-to-br ${e.color} shadow-lg`,children:o.jsx(e.icon,{className:"w-5 h-5 text-white"})}),o.jsx("span",{className:"text-sm font-medium text-blue-50 flex-1 leading-relaxed pt-1",children:e.text})]})]},t))}),!B&&o.jsx(x.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"mt-4 p-4 bg-red-500/20 border border-red-400/30 rounded-xl backdrop-blur-sm",children:o.jsxs("p",{className:"text-sm text-red-100 text-center font-medium",children:["‚ö†Ô∏è ",C("common.noInternetConnection")]})}),o.jsx(x.div,{initial:{opacity:0,scaleX:0},animate:{opacity:1,scaleX:1},transition:{duration:1,delay:1.4},className:"mt-6 h-px bg-gradient-to-r from-transparent via-white/40 to-transparent"})]})})]})})}),o.jsxs("div",{className:"lg:col-span-7 min-w-0 flex flex-col items-stretch h-full lg:max-h-[600px]",children:[o.jsxs("div",{className:"lg:hidden mb-2 px-2 sm:px-4 flex items-center justify-between",children:[o.jsxs("button",{type:"button",onClick:re,"aria-label":C("common.back"),title:C("common.back"),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-white/10 backdrop-blur border border-gray-300 dark:border-white/20 transition-colors duration-300 w-fit",children:[o.jsx(h,{className:"w-5 h-5 "+(Q?"":"rotate-180")}),o.jsx("span",{className:"text-sm font-medium",children:C("common.back")})]}),o.jsx(b,{})]}),o.jsxs("div",{className:"bg-white/80 dark:bg-gray-800/50 backdrop-blur-xl rounded-3xl shadow-2xl border border-gray-200 dark:border-gray-700/50 flex-1 flex flex-col overflow-hidden transition-colors duration-300",children:[o.jsx("div",{className:"p-4 sm:p-6 md:p-10 flex-1 min-w-0 flex flex-col justify-center",children:o.jsxs("form",{onSubmit:ie,className:"space-y-4 sm:space-y-6 min-w-0",id:"loginForm",children:[o.jsxs("div",{className:`text-center ${Q?"lg:text-right":"lg:text-left"} mb-1 sm:mb-2`,children:[o.jsx("h2",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-gray-900 dark:from-white to-blue-600 dark:to-blue-200 bg-clip-text text-transparent mb-1 sm:mb-2 transition-colors duration-300",children:C("auth.login.title")}),o.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm sm:text-base transition-colors duration-300",children:C("auth.login.subtitle")})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:C("auth.login.email")}),se("email",A,C("auth.login.emailPlaceholder"),"email",o.jsx(L,{className:"w-5 h-5"}))]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:C("auth.login.password")}),se("password",F,C("auth.login.passwordPlaceholder"),"password",o.jsx(k,{className:"w-5 h-5"}),!0),o.jsx("div",{className:"mt-2",children:o.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden transition-colors duration-300",children:o.jsx("div",{className:"h-full transition-all duration-500 "+(ae<=1?"bg-red-500 w-1/5":2===ae?"bg-orange-500 w-2/5":3===ae?"bg-yellow-500 w-3/5":4===ae?"bg-green-500 w-4/5":"bg-emerald-500 w-full")})})})]}),z.general&&o.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border-2 border-red-200 dark:border-red-800 rounded-xl animate-in fade-in duration-200",children:[o.jsx("p",{className:"text-sm font-medium text-red-700 dark:text-red-300 text-center",children:z.general}),(z.general.includes("ÿßÿ™ÿµÿßŸÑ")||z.general.includes("ÿÆÿßÿØŸÖ"))&&o.jsxs("button",{type:"button",onClick:()=>{P({}),navigator.onLine&&ie(new Event("submit"))},className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 underline font-medium mt-2",children:["üîÅ ",C("common.retry")]})]})]})}),o.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 bg-gray-50/80 dark:bg-gray-800/60 backdrop-blur-xl p-3 sm:p-4 flex items-center justify-between gap-2 sm:gap-4 transition-colors duration-300",children:[o.jsx(s,{type:"button",variant:"ghost",className:"text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors duration-300",onClick:I,disabled:$||!B||Z,children:C("auth.login.forgotPassword")}),o.jsx(s,{type:"submit",form:"loginForm",disabled:$||!B||Z,className:"flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold rounded-xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:$?o.jsxs(o.Fragment,{children:[o.jsx(n,{size:"sm",color:"white"}),C("auth.login.loggingIn")]}):o.jsxs(o.Fragment,{children:[C("auth.login.loginButton"),o.jsx(j,{className:"w-5 h-5"})]})})]})]}),o.jsx("div",{className:"text-center mt-4 sm:mt-6 lg:mt-8",children:o.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 transition-colors duration-300",children:[C("auth.login.noAccount")," ",o.jsx("button",{onClick:e,disabled:$||!B||Z,className:"font-semibold text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 hover:underline transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:C("auth.login.createAccount")})]})})]})]})})]})});S.displayName="LoginPage";export{S as default};
