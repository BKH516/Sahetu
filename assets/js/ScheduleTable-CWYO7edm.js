import{a as e,r as a,j as t,S as s,t as r,v as d,w as n,x as l,q as i,B as c,y as o,d as u,o as y,k as m,L as x}from"./index-99IqcOUf.js";import{D as g,L as p,P as h,T as b}from"./index-CYIOlG9_.js";import"./clock-sLeXm9or.js";import"./user-kOcpVDJ_.js";import"./trending-up-Hy3b_itb.js";const f=({isOpen:o,onClose:u,onEdit:y,initialData:m,isSubmitting:x})=>{const{t:h}=e(),[b,f]=a.useState({day:"",start:"",end:""});return a.useEffect(()=>{m&&f({day:m.day,start:m.start,end:m.end})},[m]),t.jsx(g,{open:o,onOpenChange:u,title:h("schedule.editAppointment")||h("common.edit"),description:h("schedule.editAppointmentDesc")||"قم بتحديث تفاصيل الموعد",children:t.jsxs("form",{onSubmit:async e=>{e.preventDefault();const a={id:m.id,...b};try{await y(a),u()}catch(t){}},className:"space-y-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),h("schedule.day")||"اليوم"]}),t.jsxs(s,{value:b.day,onValueChange:e=>f(a=>({...a,day:e})),children:[t.jsx(r,{disabled:x,className:"w-full bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 rounded-xl px-4 py-3 focus:border-blue-500 dark:focus:border-blue-400 focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-800 transition-all",children:t.jsx(d,{placeholder:h("schedule.selectDay")||"اختر اليوم"})}),t.jsx(n,{className:"dark:bg-gray-800 dark:border-gray-700 bg-white border-2 border-gray-200 rounded-xl",children:["saturday","sunday","monday","tuesday","wednesday","thursday","friday"].map(e=>t.jsx(l,{value:e,className:"text-gray-900 dark:text-white hover:bg-blue-50 dark:hover:bg-blue-900/20 focus:bg-blue-50 dark:focus:bg-blue-900/20",children:h(`schedule.days.${e}`)},e))})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),h("schedule.startTime")]}),t.jsx(i,{type:"time",value:b.start,onChange:e=>f(a=>({...a,start:e.target.value})),required:!0,disabled:x,className:"w-full bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 rounded-xl px-4 py-3 focus:border-green-500 dark:focus:border-green-400 focus:ring-2 focus:ring-green-200 dark:focus:ring-green-800 transition-all"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),h("schedule.endTime")]}),t.jsx(i,{type:"time",value:b.end,onChange:e=>f(a=>({...a,end:e.target.value})),required:!0,disabled:x,className:"w-full bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 rounded-xl px-4 py-3 focus:border-purple-500 dark:focus:border-purple-400 focus:ring-2 focus:ring-purple-200 dark:focus:ring-purple-800 transition-all"})]})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[t.jsx(c,{type:"button",variant:"outline",onClick:u,disabled:x,className:"px-6 py-3 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl font-medium transition-all",children:h("common.cancel")}),t.jsx(c,{type:"submit",disabled:x,className:"inline-flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700 text-white font-medium rounded-xl shadow-lg transition-all disabled:opacity-70 disabled:cursor-not-allowed",children:x?t.jsxs(t.Fragment,{children:[t.jsx(p,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:h("common.pleaseWait",{defaultValue:"يرجى الانتظار..."})})]}):h("schedule.updateAppointment")||h("common.save")})]})]})})},w=["saturday","sunday","monday","tuesday","wednesday","thursday","friday"];function k({value:s,onChange:r}){const{t:d}=e(),[n,l]=a.useState(!1),i=a.useRef(null);return a.useEffect(()=>{function e(e){i.current&&!i.current.contains(e.target)&&l(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),t.jsxs("div",{className:"relative w-full",ref:i,children:[t.jsxs("button",{type:"button",className:"w-full px-4 py-3 border-2 border-cyan-400 dark:border-cyan-600 rounded-xl bg-white dark:bg-gray-800 text-right text-gray-800 dark:text-gray-100 font-medium focus:outline-none focus:ring-2 focus:ring-cyan-300 dark:focus:ring-cyan-700 transition",onClick:()=>l(e=>!e),children:[s?d(`schedule.days.${s}`):d("schedule.selectDay")||"اختر اليوم",t.jsx("span",{className:"float-left",children:n?"▲":"▼"})]}),n&&t.jsx("div",{className:"absolute z-50 w-full bg-white dark:bg-gray-800 border-2 border-cyan-400 dark:border-cyan-600 rounded-xl shadow-lg mt-2 max-h-[25vh] overflow-y-auto",children:w.map(e=>t.jsx("div",{className:"px-4 py-3 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/30 text-gray-900 dark:text-gray-100 "+(s===e?"bg-cyan-100 dark:bg-cyan-900/50 font-bold":""),onClick:()=>{r(e),l(!1)},children:d(`schedule.days.${e}`)},e))})]})}const j=({isOpen:s,onClose:r,onAdd:d,existingSchedule:n,isSubmitting:l})=>{const{t:u}=e(),[y,m]=a.useState({day:"",start:"",end:""});return t.jsx(g,{open:s,onOpenChange:r,title:u("schedule.addNewAppointment")||u("schedule.addAppointment"),description:u("schedule.addAppointmentDesc")||"أدخل تفاصيل الموعد الجديد",children:t.jsxs("form",{onSubmit:async e=>{e.preventDefault();const a={day:o(y.day),start:o(y.start),end:o(y.end)},t={id:Date.now(),...a};try{await d(t),m({day:"",start:"",end:""})}catch(s){}},className:"space-y-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),u("schedule.day")||"اليوم"]}),t.jsx(k,{value:y.day,onChange:e=>m(a=>({...a,day:e}))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),u("schedule.startTime")]}),t.jsx(i,{type:"time",value:y.start,onChange:e=>m(a=>({...a,start:e.target.value})),required:!0,disabled:l,className:"w-full bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 rounded-xl px-4 py-3 focus:border-green-500 dark:focus:border-green-400 focus:ring-2 focus:ring-green-200 dark:focus:ring-green-800 transition-all"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),u("schedule.endTime")]}),t.jsx(i,{type:"time",value:y.end,onChange:e=>m(a=>({...a,end:e.target.value})),required:!0,disabled:l,className:"w-full bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 rounded-xl px-4 py-3 focus:border-purple-500 dark:focus:border-purple-400 focus:ring-2 focus:ring-purple-200 dark:focus:ring-purple-800 transition-all"})]})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[t.jsx(c,{type:"button",variant:"outline",onClick:r,disabled:l,className:"px-6 py-3 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl font-medium transition-all",children:u("common.cancel")}),t.jsx(c,{type:"submit",disabled:l,className:"inline-flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-medium rounded-xl shadow-lg transition-all disabled:opacity-70 disabled:cursor-not-allowed",children:l?t.jsxs(t.Fragment,{children:[t.jsx(p,{className:"h-4 w-4 animate-spin"}),t.jsx("span",{children:u("common.pleaseWait",{defaultValue:"يرجى الانتظار..."})})]}):u("schedule.addAppointment")})]})]})})},v=()=>{const{t:s,i18n:r}=e();r.language;const d={saturday:s("schedule.days.saturday"),sunday:s("schedule.days.sunday"),monday:s("schedule.days.monday"),tuesday:s("schedule.days.tuesday"),wednesday:s("schedule.days.wednesday"),thursday:s("schedule.days.thursday"),friday:s("schedule.days.friday")},n=Object.fromEntries(Object.entries(d).map(([e,a])=>[a,e])),[l,i]=a.useState([]),[o,g]=a.useState(!0),[w,k]=a.useState(null),[v,S]=a.useState(null),[_,C]=a.useState(null),[A,E]=a.useState(!1),[z,D]=a.useState(null),[O,T]=a.useState(null),$=(e,a)=>{C({message:e,type:a}),setTimeout(()=>C(null),3e3)},q=["saturday","sunday","monday","tuesday","wednesday","thursday","friday"],L=[...l].sort((e,a)=>q.indexOf(e.day_of_week)-q.indexOf(a.day_of_week)),[R,W]=a.useState(!1),[I,F]=a.useState(null),P=Object.keys(d).find(e=>d[e]===d[(new Date).toLocaleDateString("ar-EG",{weekday:"long"})])||"",{isAuthenticated:V}=u(),{fetchNotifications:U}=y();a.useEffect(()=>{V&&B()},[V]);const B=async()=>{g(!0),k(null);try{const e=(await m.get("/api/doctor/schedules")).data,a=Array.isArray(e)?e:Array.isArray(e.data)?e.data:[];i(a)}catch(e){k(s("schedule.loadingError"))}finally{g(!1)}},G=e=>async()=>{try{await H(e)}catch{}},H=async e=>{if(S(null),k(null),e){if(null===O){T(e);try{await m.delete(`/api/doctor/schedules/${e}`),i(a=>a.filter(a=>a.id!==e)),$(s("schedule.deleteSuccess"),"success");try{await U({silent:!0})}catch(a){}}catch(t){throw $(s("schedule.deleteError"),"error"),t}finally{T(null)}}}else $(s("schedule.deleteError"),"error")};return o?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(x,{size:"lg"})}):t.jsxs("div",{className:"space-y-6 min-h-0 relative",children:[t.jsx("div",{className:"flex justify-end gap-2",children:t.jsxs(c,{onClick:()=>W(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg shadow-md text-sm sm:text-base font-medium",children:["+ ",s("schedule.addNewAppointment")||s("schedule.addAppointment")]})}),w&&t.jsx("div",{className:"text-center text-red-500 py-2",children:w}),v&&t.jsx("div",{className:"text-center text-green-600 font-bold py-2",children:v}),t.jsx(j,{isOpen:R,onClose:()=>W(!1),onAdd:async e=>{try{await(async e=>{if(S(null),k(null),!A){E(!0);try{const t=new URLSearchParams;t.append("day_of_week",n[e.day]),t.append("start_time",e.start?.slice(0,5)),t.append("end_time",e.end?.slice(0,5));const r=await m.post("/api/doctor/schedules",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),d=r.data&&"object"==typeof r.data&&!Array.isArray(r.data)&&r.data.data?r.data.data:r.data;i(e=>[...e,d]),$(s("schedule.addSuccess"),"success");try{await U({silent:!0})}catch(a){}}catch(t){const e=t?.response?.data?.message;let a=s("schedule.addError");throw e&&e.includes("validation")?a=s("services.invalidData"):e&&e.includes("required")?a=s("services.allFieldsRequired"):e&&e.includes("conflict")&&(a=s("schedule.addError")),$(a,"error"),t}finally{E(!1)}}})(e),W(!1)}catch{}},existingSchedule:l.map(e=>({id:e.id,day:d[e.day_of_week],start:e.start_time,end:e.end_time})),isSubmitting:A}),null!==I&&t.jsx(f,{isOpen:null!==I,onClose:()=>F(null),onEdit:async e=>{try{await(async e=>{if(S(null),k(null),e&&e.id){if(null===z){D(e.id);try{const t=new URLSearchParams;t.append("day_of_week",n[e.day]),t.append("start_time",e.start?.slice(0,5)),t.append("end_time",e.end?.slice(0,5));const r=await m.post(`/api/doctor/schedules/${e.id}`,t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),d=r.data&&"object"==typeof r.data&&!Array.isArray(r.data)&&r.data.data?r.data.data:r.data;i(a=>a.map(a=>a.id===e.id?d:a)),$(s("schedule.updateSuccess"),"success");try{await U({silent:!0})}catch(a){}}catch(t){throw $(s("schedule.updateError"),"error"),t}finally{D(null)}}}else $(s("schedule.updateError"),"error")})(e),F(null)}catch{}},initialData:(()=>{const e=l[I];return{id:e.id,day:d[e.day_of_week],start:e.start_time,end:e.end_time}})(),isSubmitting:null!==z}),t.jsx("div",{className:"relative rounded-3xl shadow-lg bg-white mt-4 fade-in dark:bg-card-dark dark:shadow-[0_2px_16px_0_rgba(36,44,80,0.18)] rounded-tl-[2.5rem] rounded-br-[2.5rem] overflow-hidden",children:t.jsx("div",{className:"w-full overflow-x-auto",children:t.jsxs("table",{className:"min-w-full w-full divide-y divide-gray-200 dark:divide-zinc-700 text-center align-middle",children:[t.jsx("thead",{className:"bg-slate-50 dark:bg-zinc-800 sticky top-0 z-10",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-xs font-bold text-white uppercase tracking-wide whitespace-nowrap bg-green-600 dark:bg-green-800",children:s("schedule.day")||"اليوم"}),t.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wide whitespace-nowrap",children:s("schedule.startTime")}),t.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wide whitespace-nowrap",children:s("schedule.endTime")}),t.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-xs font-bold text-gray-700 dark:text-gray-200 uppercase tracking-wide whitespace-nowrap",children:s("services.actions")})]})}),t.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-zinc-800",children:L.map((e,a)=>{const r=e.day_of_week===P;return t.jsxs("tr",{className:`transition-colors ${r?"bg-yellow-50 dark:bg-yellow-900/30":a%2==0?"bg-white dark:bg-zinc-900":"bg-gray-50 dark:bg-zinc-800"} hover:bg-accent/10 dark:hover:bg-zinc-700`,children:[t.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 whitespace-nowrap font-medium text-gray-900 dark:text-gray-100 text-center align-middle text-sm sm:text-base",children:d[e.day_of_week]}),t.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 whitespace-nowrap text-gray-900 dark:text-gray-100 text-center align-middle text-sm sm:text-base",children:N(e.start_time)}),t.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 whitespace-nowrap text-gray-900 dark:text-gray-100 text-center align-middle text-sm sm:text-base",children:N(e.end_time)}),t.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 whitespace-nowrap text-center align-middle",children:t.jsxs("div",{className:"flex justify-center gap-2 sm:gap-3",children:[t.jsx("button",{type:"button",onClick:(n=e.id,()=>{const e=l.findIndex(e=>e.id===n);-1!==e&&F(e)}),className:"w-7 h-7 sm:w-9 sm:h-9 flex items-center justify-center rounded-full bg-blue-100 hover:bg-blue-200 text-blue-600 shadow transition-all dark:bg-blue-700 dark:hover:bg-blue-800 dark:text-white",title:s("common.edit"),children:t.jsx(h,{size:14,className:"sm:w-4 sm:h-4"})}),t.jsx("button",{type:"button",onClick:G(e.id),disabled:null!==O,className:"w-7 h-7 sm:w-9 sm:h-9 flex items-center justify-center rounded-full bg-red-100 hover:bg-red-200 text-red-600 shadow transition-all dark:bg-red-700 dark:hover:bg-red-800 dark:text-white disabled:opacity-60 disabled:cursor-not-allowed",title:s("common.delete"),children:O===e.id?t.jsx(p,{className:"sm:w-4 sm:h-4 h-3.5 w-3.5 animate-spin"}):t.jsx(b,{size:14,className:"sm:w-4 sm:h-4"})})]})})]},e.id);var n})})]})})}),_&&t.jsxs("div",{style:{position:"fixed",bottom:18,left:18,zIndex:99999,minWidth:120,maxWidth:220,padding:"7px 16px 7px 10px",borderRadius:"8px",background:"success"===_.type?"#22c55e":"#ef4444",color:"#fff",fontWeight:500,fontSize:"0.85rem",boxShadow:"0 2px 8px rgba(0,0,0,0.13)",display:"flex",alignItems:"center",gap:7,pointerEvents:"none",userSelect:"none"},children:[t.jsx("span",{style:{fontSize:"1.1em",marginRight:6,display:"flex",alignItems:"center"},children:"success"===_.type?"✔️":"⚠️"}),t.jsx("span",{style:{flex:1},children:_.message})]})]})};function N(e){if(!e)return"-";const[a,t]=e.split(":");return`${a}:${t}`}export{v as default};
